# Monitoring

A modular system for monitoring APIs, collecting request/response data, and accessing them via simple REST API written in Spring Boot.

# Solution overview

This monorepo contains a complete solution for monitoring and collecting data from multiple APIs written in Spring Boot.
It comprises two Spring Boot applications (api and collector) and a library (shipper).

To start monitoring a certain Spring Boot application, the monitoring shipper package should be imported and initialized as a Filter.
The shipper then intercepts every request/response from that API and sends a monitoring record over a local network to the collector instance (the collector is not exposed to the public internet).
The collector then saves this record to the monitoring database (MySql), where it can be accessed via the monitoring api instance. The whole solution
is designed to handle monitoring data from multiple services placed into multiple networks.

## Monitoring API

The Monitoring API module is a simple REST API for monitoring records management. It works with two entities: MonitoredEndpoint and MonitoringResult.
MonitoringResult is a record generated by the shipper and saved via the collector. It consists of three main informations:
Service name, path, and record data (request/response). This record has no explicit bindings to the MonitoredEndpoint, as it can be collected without it.
The MonitoredEndpoint records are saved configurations by the user who intends to review collected data. It consists of a user unique identifier
(email - we assume that two different users will have different emails), service name, and path. MonitoredEndpoints works as "subscriptions‚Äù; more users can
monitor one endpoint, and unsubscribing won't lead to data loss. Also, the user who creates a new subscription can immediately view historic monitoring data.
The authorization/authentication is delegated to an external IAM service, which provides auth tokens (bearer) that are validated and parsed by the Monitoring API service.
The token includes the unique identifier (email), which is then saved with the MonitoredEndpoint.


![monitoring drawio](https://github.com/user-attachments/assets/e85d2a23-82c5-43f7-8243-8adfe19aafab)

# Quick start

To run the project locally, make sure to have **Java 17 or later** and **Docker** installed.

## Run in Docker

Build the application without running tests (the database has to be running to run tests)

```bash
./mvnw clean install -DskipTests
```

Run docker compose

```bash
docker-compose up -d --build
```

three containers will be running: MySql database, monitoring-api, and monitoring-collector. The API will run on port 8080.

## Run tests

For tests to run, the database has to be running. Tests can be run

```bash
./mvnw test
```

## Run local

To run a single app, first make sure other services are running (docker-compose is recommended).
If running via docker-compose, stop the container you wish to run locally and then run:

```bash
./mvnw spring-boot:run -pl [app name]
```
